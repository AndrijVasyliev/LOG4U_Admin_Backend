"use strict";const DYNAMIC_HASH_CACHE_NAME="log4u-sw-dynamic-hash-cache",DYNAMIC_ETAG_CACHE_NAME="log4u-sw-dynamic-etag-cache",DYNAMIC_ETAG_CACHE_REG_EXP=[/.png$/,/.gif$/,/.svg$/,/.json$/,/.css$/,/.js$/],checkJs=e=>{const t=e.length;return t>=3&&"js"===e[t-1]?"bundle"===e[t-2]||"chunk"===e[t-2]||"worker"===e[t-2]?(e.splice(t-3,1),e):(e.splice(t-2,1),e):null},checkJson=e=>{const t=e.length;return t>=3&&"json"===e[t-1]?(e.splice(t-2,1),e):null},checkCss=e=>{const t=e.length;return t>=3&&"css"===e[t-1]?"chunk"===e[t-2]?(e.splice(t-3,1),e):(e.splice(t-2,1),e):null},errorEventSource=[],logs=[];function log(e,t,n){logs.push({level:e,msg:t,meta:n})}let messageChannelPort;function onInstall(e){e.waitUntil((async()=>{const e=await caches.keys();return await Promise.all(e.filter((e=>e!==DYNAMIC_HASH_CACHE_NAME&&e!==DYNAMIC_ETAG_CACHE_NAME)).map((e=>caches.delete(e))))})())}function onFetch(e){"navigate"!==e.request.mode&&"websocket"!==e.request.mode&&e.respondWith(router(e.request))}async function router(e){const t=new URL(e.url),n=t.pathname,s=n.split(".");if("GET"===e.method&&t.origin===location.origin){const c={method:e.method,headers:new Headers(e.headers),cache:"no-cache",credentials:"same-origin"},a=(checkJs(s)||checkCss(s)||checkJson(s))?.join(".");if(a){const e=await caches.open(DYNAMIC_HASH_CACHE_NAME),s=await e.match(a);if(s&&new URL(s.url).pathname===n)return s;const o=await fetch(t,c);return o.ok&&await e.put(a,o.clone()),o}const o=await caches.open(DYNAMIC_ETAG_CACHE_NAME),r=await o.match(n);if(r){const e=r.headers.get("ETag");if(!e)return r;c.headers.append("If-None-Match",e)}const i=await fetch(t,c);return 304===i.status&&r?r:(i.ok&&(i?.headers.get("ETag")||DYNAMIC_ETAG_CACHE_REG_EXP.some((e=>e.test(n))))?await o.put(n,i.clone()):r&&await o.delete(n),i)}return fetch(e)}self.addEventListener("install",onInstall),self.addEventListener("fetch",onFetch);