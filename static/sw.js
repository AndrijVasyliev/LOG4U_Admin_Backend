"use strict";const DYNAMIC_HASH_CACHE_NAME="log4u-sw-dynamic-hash-cache",DYNAMIC_HEADERS_CACHE_NAME="log4u-sw-dynamic-headers-cache",DEFAULT_CACHE_LIFETIME=2592e5,checkJs=e=>{const t=e.length;return t>=3&&"js"===e[t-1]?"bundle"===e[t-2]||"chunk"===e[t-2]||"worker"===e[t-2]?(e.splice(t-3,1),e):(e.splice(t-2,1),e):null},checkJson=e=>{const t=e.length;return t>=3&&"json"===e[t-1]?(e.splice(t-2,1),e):null},checkCss=e=>{const t=e.length;return t>=3&&"css"===e[t-1]?"chunk"===e[t-2]?(e.splice(t-3,1),e):(e.splice(t-2,1),e):null},getDateOrError=e=>{try{const t=new Date(e);return isNaN(t)?new Error:t}catch(t){return t}},getMaxAgeOrError=e=>{const t=e.toLowerCase().split(",").find((e=>e?.trim().startsWith("max-age")))?.trim();if(!t)return;const r=t.split("=")[1];return!r||isNaN(+r)?new Error:+r};function onInstall(e){self.skipWaiting()}function onActivate(e){e.waitUntil(Promise.all([(async()=>{const e=await caches.keys();return await Promise.all(e.filter((e=>e!==DYNAMIC_HASH_CACHE_NAME&&e!==DYNAMIC_HEADERS_CACHE_NAME)).map((e=>caches.delete(e))))})(),clients.claim()]))}function onFetch(e){"navigate"!==e.request.mode&&"websocket"!==e.request.mode&&e.respondWith(router(e.request))}async function router(e){const t=new URL(e.url);if("GET"===e.method&&(t.origin!==location.origin||!t.pathname.startsWith("/api")))try{const t={method:e.method,mode:e.mode,headers:new Headers(e.headers),credentials:"same-origin"},r=e.url.split("."),n=(checkJs(r)||checkCss(r)||checkJson(r))?.join(".");if(n){const r=await caches.open(DYNAMIC_HASH_CACHE_NAME),s=await r.match(n);if(s&&s.url===e.url)return console.debug("[SW] Return cached asset: ",e.url),s;const a=await fetch(e.url,t);return a.ok&&(await r.put(n,a.clone()),console.debug("[SW] Added asset: ",e.url)),console.debug("[SW] Returning asset: ",e.url),a}const s=await caches.open(DYNAMIC_HEADERS_CACHE_NAME),a=await s.match(e);if(a){const r=a.headers.get("ETag");if(r)r&&(console.debug("[SW] If-None-Match: ",r),t.headers.append("If-None-Match",r));else{const t=a?.headers.get("Expires"),r=a?.headers.get("Date"),n=a?.headers.get("Cache-Control"),o=t?getDateOrError(t):void 0,c=r?getDateOrError(r):void 0,l=n?getMaxAgeOrError(n):void 0;if(o instanceof Error)await s.delete(e),console.debug("[SW] Deleted expiresDate error: ",e.url);else if(c instanceof Error)await s.delete(e),console.debug("[SW] Deleted dateDate error: ",e.url);else if(l instanceof Error)await s.delete(e),console.debug("[SW] Deleted cacheControlMaxAge error: ",e.url);else if(c+1e3*l<new Date)await s.delete(e),console.debug("[SW] Deleted maxAge: ",e.url);else if(c<new Date+DEFAULT_CACHE_LIFETIME)await s.delete(e),console.debug("[SW] Deleted lifetime: ",e.url);else{if(!(o<new Date))return console.debug("[SW] Return cached: ",e.url),a;await s.delete(e),console.debug("[SW] Deleted expire: ",e.url)}}}const o=await fetch(e.url,t);return 304===o.status&&a?(console.debug("[SW] Return after 304: ",e.url),a):(o.ok&&(o?.headers.get("ETag")||o?.headers.get("Expires")||o?.headers.get("Date"))&&!o?.headers.get("Cache-Control")?.toLowerCase().split(",").includes("no-store")?(await s.put(e,o.clone()),console.debug("[SW] Added: ",e.url)):a&&(await s.delete(e),console.debug("[SW] Deleted bed: ",e.url)),console.debug("[SW] Returning: ",e.url),o)}catch(r){return console.error(r),fetch(e)}return fetch(e)}self.addEventListener("install",onInstall),self.addEventListener("activate",onActivate),self.addEventListener("fetch",onFetch);