"use strict";(self.webpackChunk_log4u_admin_frontend=self.webpackChunk_log4u_admin_frontend||[]).push([[2319,5822],{2319:(n,e,o)=>{o.r(e),o.d(e,{default:()=>a});o(5043);var t=o(5604),i=o(5822),l=o(8612),r=o(1079),d=o(579);function a(){const{isLoading:n,isFetching:e,data:o}=(0,t.I)({queryKey:["trucksForMap"],queryFn:r.Q8,keepPreviousData:!0,retry:!1}),a=(o||[]).filter((n=>n.lastLocation));return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(i.default,{truckListData:a}),(0,d.jsx)(l.A,{visible:n||e})]})}},5822:(n,e,o)=>{o.r(e),o.d(e,{default:()=>S});var t=o(5043),i=o(5604),l=o(5563),r=o(237),d=o(4836),a=o(3462),s=o(9347),c=o(5316),u=o(1906),v=o(8533),h=o(6600),p=o(6446),f=o(7392),m=o(4914),x=o(8612),j=o(1079),w=o(9056),g=o(6431),k=o(7166),A=o(5552),C=o(4133),E=o(9129),L=o(579);const y=t.forwardRef((function(n,e){return(0,L.jsx)(d.A,{direction:"up",ref:e,...n})}));function S(n){var e;let{truckListData:o}=n,r=A.gX,d=A.s_;1===o.length&&o[0].lastLocation&&(r={lat:o[0].lastLocation[0],lng:o[0].lastLocation[1]},d*=2);const[S,I]=t.useState(null),[F,M]=t.useState(""),[_,O]=t.useState(null),[R,U]=t.useState(!1),{refetch:z}=(0,i.I)({queryKey:["truckForMap",F],queryFn:j.k$,keepPreviousData:!0,retry:!1,enabled:!1});t.useEffect((()=>{if(F){U(!0);const n=null===o||void 0===o?void 0:o.find((n=>n.id===F)),e=n&&(null===n||void 0===n?void 0:n.lastLocation);Promise.all([z().then((n=>n.data)),e&&((null===S||void 0===S?void 0:S.geocode({location:{lat:e[0],lng:e[1]}}))||Promise.reject()).then((n=>{const e=(0,C.U)(n.results);return e?(0,E.s)(e.address_components):""}))]).then((n=>{let[e,o]=n;O(e?{...e,lastCity:o||""}:null)})).catch((()=>O(null))).finally((()=>U(!1)))}else O(null)}),[F]);const D=()=>{M("")};return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(p.A,{component:"main",sx:{flexGrow:1,p:1,height:"100%",width:"100%"},children:[(0,L.jsx)(l.Wrapper,{...(0,A.iz)(),render:n=>{const e=(0,w.dh)(),[,o]=(0,w.pn)();return t.useLayoutEffect((()=>(n===l.Status.LOADING&&o(!0),n===l.Status.FAILURE&&e({severity:"error",message:"Error loading maps!"}),n===l.Status.SUCCESS&&I(new window.google.maps.Geocoder),()=>{n===l.Status.LOADING&&o(!1)})),[n]),null}}),S?(0,L.jsx)(b,{center:r,zoom:d,mapId:A.yw,children:(0,L.jsx)(N,{children:o.map((n=>(0,L.jsx)(T,{onCLick:()=>{return e=n.id,void M(e);var e},title:"".concat(n.truckNumber,"\n").concat(n.status),position:{lat:n.lastLocation[0],lng:n.lastLocation[1]}},n.id)))})}):null]}),(0,L.jsxs)(a.A,{open:!!_,TransitionComponent:y,keepMounted:!0,onClose:D,"aria-describedby":"alert-dialog-slide-description",children:[(0,L.jsx)(h.A,{children:(0,L.jsxs)("span",{children:["TRUCK NUMBER:\xa0",(0,L.jsx)("a",{href:"./trucks/view/".concat(null===_||void 0===_?void 0:_.id),target:"_blank",children:null===_||void 0===_?void 0:_.truckNumber})]})}),(0,L.jsxs)(c.A,{children:[(0,L.jsx)(v.A,{id:"truck-status",children:"CURRENT STATUS: ".concat(null===_||void 0===_?void 0:_.status)}),(0,L.jsx)(v.A,{id:"main-contact",children:(0,L.jsxs)("span",{children:["MAIN CONTACT: ",(0,L.jsx)("b",{children:"".concat(null!==_&&void 0!==_&&_.coordinator||null!==_&&void 0!==_&&_.owner?(0,g.Pw)((null===_||void 0===_?void 0:_.coordinator)||(null===_||void 0===_?void 0:_.owner)):"")})," ".concat(null!==_&&void 0!==_&&_.coordinator||null!==_&&void 0!==_&&_.owner?((null===_||void 0===_?void 0:_.coordinator)||(null===_||void 0===_?void 0:_.owner)).fullName:""),(0,L.jsx)(f.A,{size:"small",onClick:n=>{var e;(0,k.d)(n),navigator.clipboard.writeText(" ".concat(null!==_&&void 0!==_&&_.coordinator||null!==_&&void 0!==_&&_.owner?((null===_||void 0===_?void 0:_.coordinator)||(null===_||void 0===_?void 0:_.owner)).fullName:""," ").concat((null===(e=(null===_||void 0===_?void 0:_.coordinator)||(null===_||void 0===_?void 0:_.owner))||void 0===e?void 0:e.phone)||""))},children:(0,L.jsx)(m.A,{sx:{height:"16px",width:"16px"}})})]})}),(0,L.jsx)(v.A,{id:"main-contact-number",children:(0,L.jsxs)("span",{children:["MAIN CONTACT #: ",(0,L.jsx)("a",{href:null!==_&&void 0!==_&&_.coordinator||null!==_&&void 0!==_&&_.owner?"tel:".concat(((null===_||void 0===_?void 0:_.coordinator)||(null===_||void 0===_?void 0:_.owner)).phone):void 0,target:"_blank",onClick:k.d,children:(null===(e=(null===_||void 0===_?void 0:_.coordinator)||(null===_||void 0===_?void 0:_.owner))||void 0===e?void 0:e.phone)||""})]})}),(0,L.jsx)(v.A,{id:"last-location",children:(0,L.jsxs)("span",{children:["LAST LOCATION #: ".concat(null===_||void 0===_?void 0:_.lastCity),(0,L.jsx)(f.A,{size:"small",onClick:n=>{(0,k.d)(n),navigator.clipboard.writeText("".concat(null===_||void 0===_?void 0:_.lastCity))},children:(0,L.jsx)(m.A,{sx:{height:"16px",width:"16px"}})})]})})]}),(0,L.jsx)(s.A,{children:(0,L.jsx)(u.A,{onClick:D,children:"Close"})})]}),(0,L.jsx)(x.A,{visible:R})]})}function b(n){let{center:e,zoom:o,mapId:i,children:l}=n;const r=t.useRef(null),[d,a]=t.useState();t.useEffect((()=>{r.current&&!d&&a(new window.google.maps.Map(r.current,{center:e,zoom:o,mapId:i}))}),[r,d]);const s=t.Children.only(l);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:{height:"100%",width:"100%"},ref:r,id:"map"}),t.isValidElement(s)&&t.cloneElement(s,{map:d})]})}function N(n){let{map:e,children:o}=n;const[i,l]=t.useState();return t.useEffect((()=>{if(!i&&e){const n=new r.w1({});n.setMap(e),l(n)}}),[e,i]),t.useEffect((()=>{i&&i.render()}),[e,o,i]),null===i||void 0===i||i.render(),(0,L.jsx)(L.Fragment,{children:t.Children.map(o,(n=>{if(t.isValidElement(n))return t.cloneElement(n,{map:e,clusterer:i})}))})}const T=n=>{const{onCLick:e,clusterer:o,map:i,position:l,...r}=n,[d,a]=t.useState();return t.useEffect((()=>{if(!d){const n=new window.google.maps.marker.AdvancedMarkerElement;a(n),n.addListener("click",e)}}),[d]),t.useEffect((()=>{d&&(d.map=i||null)}),[d,i]),t.useEffect((()=>{d&&(d.position=l)}),[d,l&&"".concat(null===l||void 0===l?void 0:l.lat,",").concat(null===l||void 0===l?void 0:l.lng)]),t.useEffect((()=>{d&&(null===o||void 0===o||o.addMarker(d,!1))}),[d,o]),t.useEffect((()=>{d&&Object.assign(d,r)}),[d,r]),null}}}]);
//# sourceMappingURL=2319.56467215.chunk.js.map