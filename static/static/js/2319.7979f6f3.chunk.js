"use strict";(self.webpackChunk_log4u_admin_frontend=self.webpackChunk_log4u_admin_frontend||[]).push([[2319,5822],{2319:(e,n,o)=>{o.r(n),o.d(n,{default:()=>s});o(5043);var i=o(5604),l=o(5822),t=o(8612),r=o(1079),d=o(579);function s(){const{isLoading:e,isFetching:n,data:o}=(0,i.I)({queryKey:["trucksForMap"],queryFn:r.Q8,keepPreviousData:!0,retry:!1}),s=(o||[]).filter((e=>e.lastLocation));return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(l.default,{truckListData:s}),(0,d.jsx)(t.A,{visible:e||n})]})}},5822:(e,n,o)=>{o.r(n),o.d(n,{default:()=>S});var i=o(5043),l=o(5604),t=o(5563),r=o(237),d=o(4836),s=o(1081),a=o(9347),c=o(5316),u=o(1906),v=o(8533),h=o(6600),p=o(4516),f=o(7392),m=o(6910),x=o(8612),j=o(1079),w=o(908),g=o(6431),k=o(7166),A=o(5552),C=o(4133),E=o(9129),L=o(579);const y=i.forwardRef((function(e,n){return(0,L.jsx)(d.A,{direction:"up",ref:n,...e})}));function S(e){var n;let{truckListData:o}=e,r=A.gX,d=A.s_;1===o.length&&o[0].lastLocation&&(r={lat:o[0].lastLocation[0],lng:o[0].lastLocation[1]},d*=2);const[S,T]=i.useState(null),[I,F]=i.useState(""),[M,_]=i.useState(null),[O,R]=i.useState(!1),{refetch:U}=(0,l.I)({queryKey:["truckForMap",I],queryFn:j.k$,keepPreviousData:!0,retry:!1,enabled:!1});i.useEffect((()=>{if(I){R(!0);const e=null===o||void 0===o?void 0:o.find((e=>e.id===I)),n=e&&(null===e||void 0===e?void 0:e.lastLocation);Promise.all([U().then((e=>e.data)),n&&((null===S||void 0===S?void 0:S.geocode({location:{lat:n[0],lng:n[1]}}))||Promise.reject()).then((e=>{const n=(0,C.U)(e.results);return n?(0,E.s)(n.address_components):""}))]).then((e=>{let[n,o]=e;_(n?{...n,lastCity:o||""}:null)})).catch((()=>_(null))).finally((()=>R(!1)))}else _(null)}),[I]);const z=()=>{F("")};return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(p.A,{component:"main",sx:{flexGrow:1,p:1,height:"100%",width:"100%"},children:[(0,L.jsx)(t.Wrapper,{...(0,A.iz)(),render:e=>{const n=(0,w.dh)(),[,o]=(0,w.pn)();return i.useLayoutEffect((()=>(e===t.Status.LOADING&&o(!0),e===t.Status.FAILURE&&n({severity:"error",message:"Error loading maps!"}),e===t.Status.SUCCESS&&T(new window.google.maps.Geocoder),()=>{e===t.Status.LOADING&&o(!1)})),[e]),null}}),S?(0,L.jsx)(b,{center:r,zoom:d,mapId:A.yw,children:(0,L.jsx)($,{children:o.map((e=>(0,L.jsx)(N,{onCLick:()=>{return n=e.id,void F(n);var n},title:`${e.truckNumber}\n${e.status}`,position:{lat:e.lastLocation[0],lng:e.lastLocation[1]}},e.id)))})}):null]}),(0,L.jsxs)(s.A,{open:!!M,TransitionComponent:y,keepMounted:!0,onClose:z,"aria-describedby":"alert-dialog-slide-description",children:[(0,L.jsx)(h.A,{children:(0,L.jsxs)("span",{children:["TRUCK NUMBER:\xa0",(0,L.jsx)("a",{href:`./trucks/view/${null===M||void 0===M?void 0:M.id}`,target:"_blank",children:null===M||void 0===M?void 0:M.truckNumber})]})}),(0,L.jsxs)(c.A,{children:[(0,L.jsx)(v.A,{id:"truck-status",children:`CURRENT STATUS: ${null===M||void 0===M?void 0:M.status}`}),(0,L.jsx)(v.A,{id:"main-contact",children:(0,L.jsxs)("span",{children:["MAIN CONTACT: ",(0,L.jsx)("b",{children:`${null!==M&&void 0!==M&&M.coordinator||null!==M&&void 0!==M&&M.owner?(0,g.Pw)((null===M||void 0===M?void 0:M.coordinator)||(null===M||void 0===M?void 0:M.owner)):""}`}),` ${null!==M&&void 0!==M&&M.coordinator||null!==M&&void 0!==M&&M.owner?((null===M||void 0===M?void 0:M.coordinator)||(null===M||void 0===M?void 0:M.owner)).fullName:""}`,(0,L.jsx)(f.A,{size:"small",onClick:e=>{var n;(0,k.d)(e),navigator.clipboard.writeText(` ${null!==M&&void 0!==M&&M.coordinator||null!==M&&void 0!==M&&M.owner?((null===M||void 0===M?void 0:M.coordinator)||(null===M||void 0===M?void 0:M.owner)).fullName:""} ${(null===(n=(null===M||void 0===M?void 0:M.coordinator)||(null===M||void 0===M?void 0:M.owner))||void 0===n?void 0:n.phone)||""}`)},children:(0,L.jsx)(m.A,{sx:{height:"16px",width:"16px"}})})]})}),(0,L.jsx)(v.A,{id:"main-contact-number",children:(0,L.jsxs)("span",{children:["MAIN CONTACT #: ",(0,L.jsx)("a",{href:null!==M&&void 0!==M&&M.coordinator||null!==M&&void 0!==M&&M.owner?`tel:${((null===M||void 0===M?void 0:M.coordinator)||(null===M||void 0===M?void 0:M.owner)).phone}`:void 0,target:"_blank",onClick:k.d,children:(null===(n=(null===M||void 0===M?void 0:M.coordinator)||(null===M||void 0===M?void 0:M.owner))||void 0===n?void 0:n.phone)||""})]})}),(0,L.jsx)(v.A,{id:"last-location",children:(0,L.jsxs)("span",{children:[`LAST LOCATION #: ${null===M||void 0===M?void 0:M.lastCity}`,(0,L.jsx)(f.A,{size:"small",onClick:e=>{(0,k.d)(e),navigator.clipboard.writeText(`${null===M||void 0===M?void 0:M.lastCity}`)},children:(0,L.jsx)(m.A,{sx:{height:"16px",width:"16px"}})})]})})]}),(0,L.jsx)(a.A,{children:(0,L.jsx)(u.A,{onClick:z,children:"Close"})})]}),(0,L.jsx)(x.A,{visible:O})]})}function b(e){let{center:n,zoom:o,mapId:l,children:t}=e;const r=i.useRef(null),[d,s]=i.useState();i.useEffect((()=>{r.current&&!d&&s(new window.google.maps.Map(r.current,{center:n,zoom:o,mapId:l}))}),[r,d]);const a=i.Children.only(t);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:{height:"100%",width:"100%"},ref:r,id:"map"}),i.isValidElement(a)&&i.cloneElement(a,{map:d})]})}function $(e){let{map:n,children:o}=e;const[l,t]=i.useState();return i.useEffect((()=>{if(!l&&n){const e=new r.w1({});e.setMap(n),t(e)}}),[n,l]),i.useEffect((()=>{l&&l.render()}),[n,o,l]),null===l||void 0===l||l.render(),(0,L.jsx)(L.Fragment,{children:i.Children.map(o,(e=>{if(i.isValidElement(e))return i.cloneElement(e,{map:n,clusterer:l})}))})}const N=e=>{const{onCLick:n,clusterer:o,map:l,position:t,...r}=e,[d,s]=i.useState();return i.useEffect((()=>{if(!d){const e=new window.google.maps.marker.AdvancedMarkerElement;s(e),e.addListener("click",n)}}),[d]),i.useEffect((()=>{d&&(d.map=l||null)}),[d,l]),i.useEffect((()=>{d&&(d.position=t)}),[d,t&&`${null===t||void 0===t?void 0:t.lat},${null===t||void 0===t?void 0:t.lng}`]),i.useEffect((()=>{d&&(null===o||void 0===o||o.addMarker(d,!1))}),[d,o]),i.useEffect((()=>{d&&Object.assign(d,r)}),[d,r]),null}}}]);
//# sourceMappingURL=2319.7979f6f3.chunk.js.map