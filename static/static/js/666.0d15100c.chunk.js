"use strict";(self.webpackChunk_log4u_admin_frontend=self.webpackChunk_log4u_admin_frontend||[]).push([[666],{1666:function(e,t,n){n.r(t),n.d(t,{default:function(){return Y}});var i=n(1413),a=n(3433),r=n(9439),o=n(2791),c=n(7689),s=n(6403),l=n(3418),d=n(2917),u=n(6934),f=n(2065),h=n(5699),x=n(8550),m=n(68),p=n(3994),g=n(3786),v=n(4554),b=n(9836),j=n(3382),Z=n(9281),y=n(6890),k=n(3033),C=n(5855),w=n(720),D=n(4663),S=n(890),P=n(5527),F=n(1889),N=n(3400),I=n(1588),T=n(1903),L=n(1528),O=n(5573),E=n(3199),W=n(4294),q=n(1518),R=n(344),z=n(184),_=15,A=function(e){var t=(e-new Date)/6e4;return t=t>0?Math.ceil(t):0};function H(e){var t=e.truck,n=e.index,i=o.useState(0),a=(0,r.Z)(i,2),c=a[0],d=a[1],u=t.reservedAt,f=t.reservedBy,h=u&&(0,q.Z)(new Date(u),_),x=new Date<h;o.useEffect((function(){if(x){d(A(h));var e=setInterval((function(){d(A(h))}),2e3);return function(){clearInterval(e),d(0)}}}),[x,h]);var m=(0,s.NL)(),p=(0,l.D)(R.hu,{onSuccess:function(){m.invalidateQueries({queryKey:["trucks"],refetchType:"active"})},onError:function(e){}}),g=p.mutate,v=(p.isLoading,"enhanced-table-checkbox-".concat(n)),b="".concat(x&&f?"Reserved by:\n"+f.fullName+"\nTime left: "+c+"min":"");return(0,z.jsx)(W.Z,{id:"".concat(v),title:b,sx:{m:1,height:"35px",lineHeight:"normal",fontSize:"x-small"},fullWidth:!0,variant:"contained",size:"small",color:"primary",onClickCapture:function(e){e.preventDefault(),e.stopPropagation(),g({id:t.id,reservedAt:x?null:new Date})},children:x?(0,z.jsxs)("span",{children:["Unreserve",(0,z.jsx)("br",{}),"(",c,"min)"]}):"Reserve"})}var B=n(1605),M=n(4682),U=n(5916),Q=n(7004),K=[{id:"truckNumber",orderField:"truckNumber",getData:function(e){return{data:"".concat(e.truckNumber)}},numeric:!0,disablePadding:!1,label:"Truck\xa0Number"},{id:"mainContactInfo",getData:function(e){var t=e.coordinator||e.owner,n="",i="",a="",r="";return t&&(n="./".concat((0,U.DW)(t),"/view/").concat(t.id),i="".concat((0,U.oL)(t)," "),a="".concat(t.fullName),r="".concat(null===t||void 0===t?void 0:t.phone)),{data:(0,z.jsxs)("span",{children:[(0,z.jsx)("b",{children:i}),(0,z.jsx)("a",{href:n,target:"_blank",onClick:Q.U,children:a}),(0,z.jsx)("br",{}),(0,z.jsx)("a",{href:r?"tel:".concat(r):void 0,target:"_blank",onClick:Q.U,children:r||"\xa0"})]}),title:i+""+a+"\n"+r}},numeric:!1,disablePadding:!0,label:"Main\xa0Contact\xa0info"},{id:"truckInfo",getData:function(e){var t=e.type?"".concat(e.type):"",n=e.equipment?"".concat(e.equipment.join(", ")):"";return{data:(0,z.jsxs)("span",{children:[t,(0,z.jsx)("br",{}),n]}),title:t+"\n"+n}},numeric:!1,disablePadding:!0,label:"Truck\xa0info"},{id:"payload",getData:function(e){var t=e.grossWeight?"".concat(e.grossWeight):"",n=e.payload?"".concat(e.payload):"";return{data:(0,z.jsxs)("span",{children:[t,(0,z.jsx)("br",{}),n]}),title:t+"\n"+n}},numeric:!1,disablePadding:!0,label:"Weight/Payload"},{id:"dims",getData:function(e){var t=e.insideDims?"".concat(e.insideDims):"",n=e.doorDims?"".concat(e.doorDims):"";return{data:(0,z.jsxs)("span",{children:[t,(0,z.jsx)("br",{}),n]}),title:t+"\n"+n}},numeric:!1,disablePadding:!0,label:"Inside/Door DIMS"},{id:"status",orderField:"status",getData:function(e){return{data:"".concat(e.status)}},numeric:!1,disablePadding:!0,label:"Status"},{id:"roadsDistance",getData:function(e){return{data:"".concat(e.milesByRoads?e.milesByRoads.toFixed(2):"")}},numeric:!1,disablePadding:!0,label:"Road\xa0distance"},{id:"location",getData:function(e){if(null!==e&&void 0!==e&&e.lastCity){var t="./locations/view/".concat(e.lastCity.id),n="".concat(e.lastCity.name,", ").concat(e.lastCity.stateCode,", ").concat(e.lastCity.zipCode,","),i="".concat(e.locationUpdatedAt?new Date(e.locationUpdatedAt).toLocaleString():"");return{data:(0,z.jsxs)("span",{children:[(0,z.jsx)("a",{href:t,target:"_blank",onClick:Q.U,children:n}),(0,z.jsx)("br",{}),i]}),title:n+"\n"+i}}return{data:""}},numeric:!1,disablePadding:!0,label:"Last\xa0known\xa0location"},{id:"calcDistance",getData:function(e){return{data:"".concat(e.milesHaversine?e.milesHaversine.toFixed(2):"")}},numeric:!1,disablePadding:!0,label:"Origin\xa0away"}],J=(0,u.ZP)(y.Z)((function(e){return{backgroundColor:e.theme.palette.background.default}})),G=(0,u.ZP)(p.Z)((function(e){e.theme;return{maxWidth:"100px",paddingTop:"6px",paddingBottom:"6px",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}}));function V(e){e.onSelectAllClick;var t=e.order,n=e.orderBy,i=(e.numSelected,e.rowCount,e.onRequestSort);return(0,z.jsx)(J,{children:(0,z.jsxs)(C.Z,{children:[(0,z.jsx)(G,{align:"center",padding:"checkbox",children:"Actions"}),K.map((function(e){return(0,z.jsx)(G,{align:e.numeric?"right":"center",padding:e.disablePadding?"none":"normal",sortDirection:n===e.id&&t,children:(0,z.jsxs)(w.Z,{active:e.orderField&&n===e.orderField,hideSortIcon:!e.orderField,direction:n===e.orderField?t:"asc",onClick:e.orderField?(a=e.orderField,function(e){i(e,a)}):function(){},children:[e.label,e.orderField&&n===e.orderField?(0,z.jsx)(v.Z,{component:"span",sx:O.Z,children:"desc"===t?"sorted descending":"sorted ascending"}):null]})},e.id);var a}))]})})}function X(e){var t=e.selected,n=e.setQueryParams,u=o.useState(null),p=(0,r.Z)(u,2),b=p[0],j=p[1],Z=o.useState(""),y=(0,r.Z)(Z,2),k=y[0],C=y[1],w=o.useState({}),P=(0,r.Z)(w,2),O=P[0],W=P[1],q=o.useState([]),_=(0,r.Z)(q,2),A=_[0],H=_[1],Q=o.useState(200),K=(0,r.Z)(Q,2),J=K[0],G=K[1],V=o.useState(!1),X=(0,r.Z)(V,2),Y=X[0],$=X[1],ee=((0,c.TH)(),(0,c.s0)(),(0,s.NL)()),te=(0,M.Ds)(),ne=(0,l.D)(R.RS,{onSuccess:function(){te({severity:"success",message:"Deleted"}),ee.invalidateQueries(["trucks"])},onError:function(e){te({severity:"error",message:e instanceof Error?e.message:JSON.stringify(e)})}}),ie=(ne.mutate,ne.isLoading),ae=o.useMemo((function(){return(0,E.Z)((function(e){W({search:e})}),400)}),[]),re=(0,d.a)({queryKey:["locations",0,15,"name","asc",O],queryFn:(0,U.vc)(R.He,!0),keepPreviousData:!0,retry:!1}).data,oe=(void 0===re?{items:[],total:0}:re).items;o.useEffect((function(){if(b){var e=oe.filter((function(e){return e.id!==b.id}));H([b].concat((0,a.Z)(e)))}else H(""===k?[]:(0,a.Z)(oe))}),[b,oe]);return(0,z.jsxs)(D.Z,{sx:(0,i.Z)({pl:{sm:2},pr:{xs:1,sm:1}},t.length>0&&{bgcolor:function(e){return(0,f.Fq)(e.palette.primary.main,e.palette.action.activatedOpacity)}}),children:[t.length>0?(0,z.jsxs)(S.Z,{sx:{flex:"1 1 100%"},color:"inherit",variant:"subtitle1",component:"div",children:[t.length," selected"]}):(0,z.jsx)(S.Z,{sx:{flex:"1 1 100%",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},variant:"h6",id:"tableTitle",component:"div",children:"Trucks Nearby"}),(0,z.jsx)(v.Z,{component:"div",sx:{"& .MuiTextField-root":{m:1,width:"350px"}},children:(0,z.jsx)(h.Z,{getOptionLabel:function(e){return"string"===typeof e?e:"".concat(e.name,", ").concat(e.zipCode,", ").concat(e.stateName)},filterOptions:function(e){return e},options:A,autoComplete:!0,includeInputInList:!0,filterSelectedOptions:!1,value:b,noOptionsText:"No locations",onChange:function(e,t){j(t),null!==t&&void 0!==t&&t.location?(n({lastLocation:t.location.join(","),distance:J}),$(!1)):t||(C(""),n({}),$(!1))},onInputChange:function(e,t){C(t),ae(t)},renderInput:function(e){return(0,z.jsx)(x.Z,(0,i.Z)((0,i.Z)({},e),{},{label:"Enter city, state or zip",size:"small",fullWidth:!0}))},renderOption:function(e,t){return(0,z.jsx)("li",(0,i.Z)((0,i.Z)({},e),{},{children:(0,z.jsxs)(F.ZP,{container:!0,alignItems:"center",children:[(0,z.jsx)(F.ZP,{item:!0,sx:{display:"flex",width:44},children:(0,z.jsx)(I.Z,{sx:{color:"text.secondary"}})}),(0,z.jsxs)(F.ZP,{item:!0,sx:{width:"calc(100% - 44px)",wordWrap:"break-word"},children:[(0,z.jsx)(v.Z,{component:"span",sx:{fontWeight:"regular"},children:"".concat(t.name,", ").concat(t.stateCode)}),(0,z.jsx)(S.Z,{variant:"body2",color:"text.secondary",children:"".concat(t.zipCode,", ").concat(t.stateName)})]})]})}))}})}),(0,z.jsx)(v.Z,{component:"div",sx:{"& .MuiTextField-root":{m:1,width:"140px"}},children:(0,z.jsx)(x.Z,{select:!0,label:"Select Distance",value:J,onChange:function(e){Number.isInteger(Number(e.target.value))&&(G(Number(e.target.value)),null!==b&&void 0!==b&&b.location&&(n({lastLocation:b.location.join(","),distance:Number(e.target.value)}),$(!1)))},size:"small",fullWidth:!0,children:Array.from({length:20},(function(e,t){return 50+50*t})).map((function(e){return(0,z.jsx)(g.Z,{value:e,children:e},e)}))})}),(0,z.jsx)(m.Z,{title:"Filter list",children:!Y&&b||Y&&!b?(0,z.jsx)("span",{children:(0,z.jsx)(N.Z,{onClick:function(){j(null),C(""),G(200),n({}),$(!1)},children:(0,z.jsx)(L.Z,{})})}):(0,z.jsx)("span",{children:(0,z.jsx)(N.Z,{disabled:!b||!J,onClick:function(){null!==b&&void 0!==b&&b.location?n({lastLocation:b.location.join(","),distance:J}):n({}),$(!1)},children:(0,z.jsx)(T.Z,{})})})}),(0,z.jsx)(B.Z,{visible:ie})]})}function Y(){var e=o.useState(void 0),t=(0,r.Z)(e,2),n=t[0],i=t[1],a=o.useState(void 0),s=(0,r.Z)(a,2),l=s[0],u=s[1],f=o.useState([]),h=(0,r.Z)(f,2),x=h[0],m=h[1],p=o.useState(0),g=(0,r.Z)(p,2),y=g[0],w=g[1],D=o.useState(15),S=(0,r.Z)(D,2),F=S[0],N=S[1],I=o.useState({}),T=(0,r.Z)(I,2),L=T[0],O=T[1],E=o.useRef(null),W=(0,c.TH)(),q=(0,c.s0)(),_=(0,M.Ds)(),A=(0,d.a)({queryKey:["trucks",y,F,l,n,L],queryFn:R.g7,keepPreviousData:!0,retry:!1,onError:function(e){_({severity:"error",message:e instanceof Error?e.message:JSON.stringify(e)})}}),U=A.isLoading,Q=A.isFetching,J=A.data,Y=void 0===J?{items:[],total:0}:J,$=Y.items,ee=Y.total,te=$||[];o.useEffect((function(){E.current&&E.current.scrollTo({top:0,left:0,behavior:"smooth"})}),[te]),o.useEffect((function(){var e=[];x.forEach((function(t){te.find((function(e){return e.id===t}))&&e.push(t)})),m(e)}),[te]);return(0,z.jsxs)(v.Z,{sx:{width:"100%",height:"100%"},children:[(0,z.jsxs)(P.Z,{sx:{width:"100%",height:"100%",backgroundColor:"unset"},children:[(0,z.jsx)(X,{selected:x,setQueryParams:function(e){O(e),w(0)}}),(0,z.jsx)(Z.Z,{ref:E,sx:{height:"calc(100% - 115px)"},children:(0,z.jsxs)(b.Z,{sx:{minWidth:750},"aria-labelledby":"tableTitle",size:"small",stickyHeader:!0,children:[(0,z.jsx)(V,{numSelected:x.length,order:n,orderBy:l,onSelectAllClick:function(e){if(e.target.checked){var t=te.map((function(e){return e.id}));m(t)}else m([])},onRequestSort:function(e,t){var a=l===t&&"asc"===n;l===t&&"desc"===n?(i(void 0),u(void 0)):(i(a?"desc":"asc"),u(t))},rowCount:te.length}),(0,z.jsx)(j.Z,{children:te.map((function(e,t){var n,i=(n="".concat(e.id),-1!==x.indexOf(n));return(0,z.jsxs)(C.Z,{hover:!0,onClick:function(t){q("./view/".concat(e.id),{relative:"path",state:{from:W},replace:!1})},role:"checkbox","aria-checked":i,tabIndex:-1,selected:i,sx:{cursor:"pointer"},children:[(0,z.jsx)(G,{padding:"checkbox",children:(0,z.jsx)(H,{truck:e,index:t})}),K.map((function(t){var n=t.getData(e);return(0,z.jsx)(G,{title:n.title,align:t.numeric?"right":"center",children:n.data},t.id)}))]},e.id)}))})]})}),(0,z.jsx)(k.Z,{rowsPerPageOptions:[5,10,15,20,25,35,50],component:"div",count:ee,rowsPerPage:F,page:y,onPageChange:function(e,t){w(t)},onRowsPerPageChange:function(e){N(parseInt(e.target.value,10)),w(0)}})]}),(0,z.jsx)(B.Z,{visible:U||Q})]})}}}]);
//# sourceMappingURL=666.0d15100c.chunk.js.map