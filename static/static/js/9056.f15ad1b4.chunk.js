"use strict";(self.webpackChunk_log4u_admin_frontend=self.webpackChunk_log4u_admin_frontend||[]).push([[9056,8936],{9056:function(n,o,e){e.r(o),e.d(o,{default:function(){return u}});e(2791);var t=e(2917),i=e(8936),r=e(1605),l=e(344),a=e(184);function u(){var n=(0,t.a)({queryKey:["trucksForMap"],queryFn:l.vD,keepPreviousData:!1,retry:!1}),o=n.isLoading,e=n.isFetching,u=(n.data||[]).filter((function(n){return n.lastLocation}));return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.default,{truckListData:u}),(0,a.jsx)(r.Z,{visible:o||e})]})}},8936:function(n,o,e){e.r(o),e.d(o,{default:function(){return M}});var t=e(5987),i=e(9439),r=e(1413),l=e(2791),a=e(2917),u=e(9259),c=e(1697),d=e(5931),s=e(5574),v=e(7123),f=e(9157),h=e(4294),p=e(1691),m=e(5661),x=e(4554),j=e(3400),g=e(194),Z=e(1605),w=e(344),k=e(9063),C=e(5916),L=e(7004),E=e(4633),b=e(3026),y=e(901),S=e(184),N=["onCLick","clusterer","map","position"],T=l.forwardRef((function(n,o){return(0,S.jsx)(d.Z,(0,r.Z)({direction:"up",ref:o},n))}));function M(n){var o,e=n.truckListData,t=E.be,c=E.sP;1===e.length&&e[0].lastLocation&&(t={lat:e[0].lastLocation[0],lng:e[0].lastLocation[1]},c*=2);var d=l.useState(null),N=(0,i.Z)(d,2),M=N[0],I=N[1],_=l.useState(""),D=(0,i.Z)(_,2),O=D[0],R=D[1],z=l.useState(null),q=(0,i.Z)(z,2),P=q[0],G=q[1],K=l.useState(!1),V=(0,i.Z)(K,2),B=V[0],W=V[1],X=(0,a.a)({queryKey:["truckForMap",O],queryFn:w.dC,keepPreviousData:!1,retry:!1,enabled:!1}).refetch;l.useEffect((function(){if(O){W(!0);var n=null===e||void 0===e?void 0:e.find((function(n){return n.id===O})),o=n&&(null===n||void 0===n?void 0:n.lastLocation);Promise.all([X().then((function(n){return n.data})),o&&(null===M||void 0===M?void 0:M.geocode({location:{lat:o[0],lng:o[1]}}).then((function(n){var o=(0,b.F)(n.results);return o?(0,y.u)(o.address_components):""})))]).then((function(n){var o=(0,i.Z)(n,2),e=o[0],t=o[1];G(e?(0,r.Z)((0,r.Z)({},e),{},{lastCity:t||""}):null)})).catch((function(){return G(null)})).finally((function(){return W(!1)}))}else G(null)}),[O]);var H=function(){R("")};return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(x.Z,{component:"main",sx:{flexGrow:1,p:1,height:"100%",width:"100%"},children:[(0,S.jsx)(u.Wrapper,(0,r.Z)((0,r.Z)({},(0,E.z0)()),{},{render:function(n){var o=(0,k.Ds)(),e=(0,k.U2)(),t=(0,i.Z)(e,2)[1];return l.useLayoutEffect((function(){return n===u.Status.LOADING&&t(!0),n===u.Status.FAILURE&&o({severity:"error",message:"Error loading maps!"}),n===u.Status.SUCCESS&&I(new window.google.maps.Geocoder),function(){n===u.Status.LOADING&&t(!1)}}),[n]),null}})),M?(0,S.jsx)(A,{center:t,zoom:c,mapId:E.Kq,children:(0,S.jsx)(F,{children:e.map((function(n){return(0,S.jsx)(U,{onCLick:function(){return o=n.id,void R(o);var o},title:"".concat(n.truckNumber,"\n").concat(n.status),position:{lat:n.lastLocation[0],lng:n.lastLocation[1]}},n.id)}))})}):null]}),(0,S.jsxs)(s.Z,{open:!!P,TransitionComponent:T,keepMounted:!0,onClose:H,"aria-describedby":"alert-dialog-slide-description",children:[(0,S.jsx)(m.Z,{children:(0,S.jsxs)("span",{children:["TRUCK NUMBER:\xa0",(0,S.jsx)("a",{href:"./trucks/view/".concat(null===P||void 0===P?void 0:P.id),target:"_blank",children:null===P||void 0===P?void 0:P.truckNumber})]})}),(0,S.jsxs)(f.Z,{children:[(0,S.jsx)(p.Z,{id:"truck-status",children:"CURRENT STATUS: ".concat(null===P||void 0===P?void 0:P.status)}),(0,S.jsx)(p.Z,{id:"main-contact",children:(0,S.jsxs)("span",{children:["MAIN CONTACT: ",(0,S.jsx)("b",{children:"".concat(null!==P&&void 0!==P&&P.coordinator||null!==P&&void 0!==P&&P.owner?(0,C.oL)((null===P||void 0===P?void 0:P.coordinator)||(null===P||void 0===P?void 0:P.owner)):"")})," ".concat(null!==P&&void 0!==P&&P.coordinator||null!==P&&void 0!==P&&P.owner?((null===P||void 0===P?void 0:P.coordinator)||(null===P||void 0===P?void 0:P.owner)).fullName:""),(0,S.jsx)(j.Z,{size:"small",onClick:function(n){var o;(0,L.U)(n),navigator.clipboard.writeText(" ".concat(null!==P&&void 0!==P&&P.coordinator||null!==P&&void 0!==P&&P.owner?((null===P||void 0===P?void 0:P.coordinator)||(null===P||void 0===P?void 0:P.owner)).fullName:""," ").concat((null===(o=(null===P||void 0===P?void 0:P.coordinator)||(null===P||void 0===P?void 0:P.owner))||void 0===o?void 0:o.phone)||""))},children:(0,S.jsx)(g.Z,{sx:{height:"16px",width:"16px"}})})]})}),(0,S.jsx)(p.Z,{id:"main-contact-number",children:(0,S.jsxs)("span",{children:["MAIN CONTACT #: ",(0,S.jsx)("a",{href:null!==P&&void 0!==P&&P.coordinator||null!==P&&void 0!==P&&P.owner?"tel:".concat(((null===P||void 0===P?void 0:P.coordinator)||(null===P||void 0===P?void 0:P.owner)).phone):void 0,target:"_blank",onClick:L.U,children:(null===(o=(null===P||void 0===P?void 0:P.coordinator)||(null===P||void 0===P?void 0:P.owner))||void 0===o?void 0:o.phone)||""})]})}),(0,S.jsx)(p.Z,{id:"last-location",children:(0,S.jsxs)("span",{children:["LAST LOCATION #: ".concat(null===P||void 0===P?void 0:P.lastCity),(0,S.jsx)(j.Z,{size:"small",onClick:function(n){(0,L.U)(n),navigator.clipboard.writeText("".concat(null===P||void 0===P?void 0:P.lastCity))},children:(0,S.jsx)(g.Z,{sx:{height:"16px",width:"16px"}})})]})})]}),(0,S.jsx)(v.Z,{children:(0,S.jsx)(h.Z,{onClick:H,children:"Close"})})]}),(0,S.jsx)(Z.Z,{visible:B})]})}function A(n){var o=n.center,e=n.zoom,t=n.mapId,r=n.children,a=l.useRef(null),u=l.useState(),c=(0,i.Z)(u,2),d=c[0],s=c[1];l.useEffect((function(){a.current&&!d&&s(new window.google.maps.Map(a.current,{center:o,zoom:e,mapId:t}))}),[a,d]);var v=l.Children.only(r);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{style:{height:"100%",width:"100%"},ref:a,id:"map"}),l.isValidElement(v)&&l.cloneElement(v,{map:d})]})}function F(n){var o=n.map,e=n.children,t=l.useState(),r=(0,i.Z)(t,2),a=r[0],u=r[1];return l.useEffect((function(){return a||u(new c.XL({})),function(){a&&a.setMap(null)}}),[a]),l.useEffect((function(){a&&o&&a.setMap(o)}),[o]),l.useEffect((function(){a&&a.render()}),[o,e]),null===a||void 0===a||a.render(),(0,S.jsx)(S.Fragment,{children:l.Children.map(e,(function(n){if(l.isValidElement(n))return l.cloneElement(n,{map:o,clusterer:a})}))})}var U=function(n){var o=n.onCLick,e=n.clusterer,r=n.map,a=n.position,u=(0,t.Z)(n,N),c=l.useState(),d=(0,i.Z)(c,2),s=d[0],v=d[1];return l.useEffect((function(){if(!s){var n=new window.google.maps.marker.AdvancedMarkerElement;v(n),n.addListener("click",o)}return function(){s&&(s.map=null,null===e||void 0===e||e.removeMarker(s,!1))}}),[s]),l.useEffect((function(){s&&(s.map=r||null)}),[s,r]),l.useEffect((function(){s&&(s.position=a)}),[s,a&&"".concat(null===a||void 0===a?void 0:a.lat,",").concat(null===a||void 0===a?void 0:a.lng)]),l.useEffect((function(){s&&(null===e||void 0===e||e.addMarker(s,!1))}),[s,e]),l.useEffect((function(){s&&Object.assign(s,u)}),[s,u]),null}},7004:function(n,o,e){function t(n){n.stopPropagation()}e.d(o,{U:function(){return t}})}}]);
//# sourceMappingURL=9056.f15ad1b4.chunk.js.map