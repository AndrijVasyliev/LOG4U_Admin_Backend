"use strict";(self.webpackChunk_log4u_admin_frontend=self.webpackChunk_log4u_admin_frontend||[]).push([[666],{1666:function(e,t,n){n.r(t),n.d(t,{default:function(){return $}});var i=n(1413),a=n(3433),r=n(9439),o=n(2791),c=n(7689),s=n(6403),l=n(3418),d=n(2917),u=n(6934),f=n(2065),x=n(5699),h=n(8550),p=n(68),m=n(3994),g=n(3786),v=n(4554),j=n(9836),b=n(3382),Z=n(9281),y=n(6890),k=n(3033),w=n(5855),C=n(720),D=n(4663),S=n(890),P=n(5527),F=n(1889),N=n(3400),T=n(1588),I=n(1903),O=n(1528),L=n(194),z=n(5573),E=n(3199),q=n(4294),A=n(1518),R=n(344),_=n(184),U=15,W=function(e){var t=(e-new Date)/6e4;return t=t>0?Math.ceil(t):0};function H(e){var t=e.truck,n=e.index,i=o.useState(0),a=(0,r.Z)(i,2),c=a[0],d=a[1],u=t.reservedAt,f=t.reservedBy,x=u&&(0,A.Z)(new Date(u),U),h=new Date<x;o.useEffect((function(){if(h){d(W(x));var e=setInterval((function(){d(W(x))}),2e3);return function(){clearInterval(e),d(0)}}}),[h,x]);var p=(0,s.NL)(),m=(0,l.D)(R.hu,{onSuccess:function(){p.invalidateQueries({queryKey:["trucks"],refetchType:"active"})},onError:function(e){}}),g=m.mutate,v=(m.isLoading,"enhanced-table-checkbox-".concat(n)),j="".concat(h&&f?"Reserved by:\n"+f.fullName+"\nTime left: "+c+"min":"");return(0,_.jsx)(q.Z,{id:"".concat(v),title:j,sx:{m:1,height:"35px",lineHeight:"normal",fontSize:"x-small"},fullWidth:!0,variant:"contained",size:"small",color:"primary",onClickCapture:function(e){e.preventDefault(),e.stopPropagation(),g({id:t.id,reservedAt:h?null:new Date})},children:h?(0,_.jsxs)("span",{children:["Unreserve",(0,_.jsx)("br",{}),"(",c,"min)"]}):"Reserve"})}var B=n(1605),M=n(4682),Q=n(5916),K=n(7004),J=[{id:"truckNumber",orderField:"truckNumber",getData:function(e){return{data:"".concat(e.truckNumber)}},numeric:!0,disablePadding:!1,label:"Truck\xa0Number"},{id:"mainContactInfo",getData:function(e){var t=e.coordinator||e.owner,n="",i="",a="",r="";return t&&(n="./".concat((0,Q.DW)(t),"/view/").concat(t.id),i="".concat((0,Q.oL)(t)," "),a="".concat(t.fullName),r="".concat(null===t||void 0===t?void 0:t.phone)),{data:(0,_.jsxs)("span",{style:{display:"flex"},children:[(0,_.jsxs)("span",{style:{textOverflow:"ellipsis",overflow:"hidden",textAlign:"left"},children:[(0,_.jsx)("b",{children:i}),(0,_.jsx)("a",{href:n,target:"_blank",onClick:K.U,children:a}),(0,_.jsx)("br",{}),(0,_.jsx)("a",{href:r?"tel:".concat(r):void 0,target:"_blank",onClick:K.U,children:r||"\xa0"})]}),(0,_.jsx)(N.Z,{size:"small",onClick:function(e){(0,K.U)(e),navigator.clipboard.writeText(a+" "+r)},children:(0,_.jsx)(L.Z,{sx:{height:"16px",width:"16px"}})})]}),title:i+""+a+"\n"+r}},numeric:!1,disablePadding:!0,label:"Main\xa0Contact\xa0info"},{id:"truckInfo",getData:function(e){var t=e.type?"".concat(e.type):"",n=e.equipment?"".concat(e.equipment.join(", ")):"";return{data:(0,_.jsxs)("span",{children:[t,(0,_.jsx)("br",{}),n]}),title:t+"\n"+n}},numeric:!1,disablePadding:!0,label:"Truck\xa0info"},{id:"dimsAndPayload",getData:function(e){var t=e.insideDims?"".concat(e.insideDims):"",n=e.doorDims?"".concat(e.doorDims):"",i=e.payload?"".concat(e.payload):"";return{data:(0,_.jsxs)("span",{children:[(t?t+" ":"")+n,(0,_.jsx)("br",{}),i]}),title:(t?t+" Inside ":"")+(n?n+" Door ":"")+"\n"+i+" Payload"}},numeric:!1,disablePadding:!0,label:"DIMS/Payload"},{id:"status",orderField:"status",getData:function(e){return{data:"".concat(e.status)}},numeric:!1,disablePadding:!0,label:"Status"},{id:"roadsDistance",getData:function(e){return{data:"".concat(e.milesByRoads?e.milesByRoads.toFixed(2):"")}},numeric:!1,disablePadding:!0,label:"Road\xa0distance"},{id:"location",getData:function(e){if(null!==e&&void 0!==e&&e.lastCity){var t="./locations/view/".concat(e.lastCity.id),n="".concat(e.lastCity.name,", ").concat(e.lastCity.stateCode,", ").concat(e.lastCity.zipCode),i="".concat(e.locationUpdatedAt?new Date(e.locationUpdatedAt).toLocaleString():"");return{data:(0,_.jsxs)("span",{style:{display:"flex"},children:[(0,_.jsxs)("span",{style:{textOverflow:"ellipsis",overflow:"hidden"},children:[(0,_.jsx)("a",{href:t,target:"_blank",onClick:K.U,children:n}),(0,_.jsx)("br",{}),i]}),(0,_.jsx)(N.Z,{size:"small",onClick:function(e){(0,K.U)(e),navigator.clipboard.writeText(n)},children:(0,_.jsx)(L.Z,{sx:{height:"16px",width:"16px"}})})]}),title:n+"\n"+i}}return{data:""}},numeric:!1,disablePadding:!0,label:"Last\xa0known\xa0location"},{id:"calcDistance",getData:function(e){return{data:"".concat(e.milesHaversine?e.milesHaversine.toFixed(2):"")}},numeric:!1,disablePadding:!0,label:"Origin\xa0away"}],G=(0,u.ZP)(y.Z)((function(e){return{backgroundColor:e.theme.palette.background.default}})),V=(0,u.ZP)(m.Z)((function(e){e.theme;return{maxWidth:"100px",paddingTop:"6px",paddingBottom:"6px",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}}));function X(e){e.onSelectAllClick;var t=e.order,n=e.orderBy,i=(e.numSelected,e.rowCount,e.onRequestSort);return(0,_.jsx)(G,{children:(0,_.jsxs)(w.Z,{children:[(0,_.jsx)(V,{align:"center",padding:"checkbox",children:"Actions"}),J.map((function(e){return(0,_.jsx)(V,{align:e.numeric?"right":"center",padding:e.disablePadding?"none":"normal",sortDirection:n===e.id&&t,children:(0,_.jsxs)(C.Z,{active:e.orderField&&n===e.orderField,hideSortIcon:!e.orderField,direction:n===e.orderField?t:"asc",onClick:e.orderField?(a=e.orderField,function(e){i(e,a)}):function(){},children:[e.label,e.orderField&&n===e.orderField?(0,_.jsx)(v.Z,{component:"span",sx:z.Z,children:"desc"===t?"sorted descending":"sorted ascending"}):null]})},e.id);var a}))]})})}function Y(e){var t=e.selected,n=e.setQueryParams,u=o.useState(null),m=(0,r.Z)(u,2),j=m[0],b=m[1],Z=o.useState(""),y=(0,r.Z)(Z,2),k=y[0],w=y[1],C=o.useState({}),P=(0,r.Z)(C,2),L=P[0],z=P[1],q=o.useState([]),A=(0,r.Z)(q,2),U=A[0],W=A[1],H=o.useState(200),K=(0,r.Z)(H,2),J=K[0],G=K[1],V=o.useState(!1),X=(0,r.Z)(V,2),Y=X[0],$=X[1],ee=((0,c.TH)(),(0,c.s0)(),(0,s.NL)()),te=(0,M.Ds)(),ne=(0,l.D)(R.RS,{onSuccess:function(){te({severity:"success",message:"Deleted"}),ee.invalidateQueries(["trucks"])},onError:function(e){te({severity:"error",message:e instanceof Error?e.message:JSON.stringify(e)})}}),ie=(ne.mutate,ne.isLoading),ae=o.useMemo((function(){return(0,E.Z)((function(e){z({search:e})}),400)}),[]),re=(0,d.a)({queryKey:["locations",0,15,"name","asc",L],queryFn:(0,Q.vc)(R.He,!0),keepPreviousData:!0,retry:!1}).data,oe=(void 0===re?{items:[],total:0}:re).items;o.useEffect((function(){if(j){var e=oe.filter((function(e){return e.id!==j.id}));W([j].concat((0,a.Z)(e)))}else W(""===k?[]:(0,a.Z)(oe))}),[j,oe]);return(0,_.jsxs)(D.Z,{sx:(0,i.Z)({pl:{sm:2},pr:{xs:1,sm:1}},t.length>0&&{bgcolor:function(e){return(0,f.Fq)(e.palette.primary.main,e.palette.action.activatedOpacity)}}),children:[t.length>0?(0,_.jsxs)(S.Z,{sx:{flex:"1 1 100%"},color:"inherit",variant:"subtitle1",component:"div",children:[t.length," selected"]}):(0,_.jsx)(S.Z,{sx:{flex:"1 1 100%",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},variant:"h6",id:"tableTitle",component:"div",children:"Trucks Nearby"}),(0,_.jsx)(v.Z,{component:"div",sx:{"& .MuiTextField-root":{m:1,width:"350px"}},children:(0,_.jsx)(x.Z,{getOptionLabel:function(e){return"string"===typeof e?e:"".concat(e.name,", ").concat(e.zipCode,", ").concat(e.stateName)},filterOptions:function(e){return e},options:U,autoComplete:!0,includeInputInList:!0,filterSelectedOptions:!1,value:j,noOptionsText:"No locations",onChange:function(e,t){b(t),null!==t&&void 0!==t&&t.location?(n({lastLocation:t.location.join(","),distance:J}),$(!1)):t||(w(""),n({}),$(!1))},onInputChange:function(e,t){w(t),ae(t)},renderInput:function(e){return(0,_.jsx)(h.Z,(0,i.Z)((0,i.Z)({},e),{},{label:"Enter city, state or zip",size:"small",fullWidth:!0}))},renderOption:function(e,t){return(0,_.jsx)("li",(0,i.Z)((0,i.Z)({},e),{},{children:(0,_.jsxs)(F.ZP,{container:!0,alignItems:"center",children:[(0,_.jsx)(F.ZP,{item:!0,sx:{display:"flex",width:44},children:(0,_.jsx)(T.Z,{sx:{color:"text.secondary"}})}),(0,_.jsxs)(F.ZP,{item:!0,sx:{width:"calc(100% - 44px)",wordWrap:"break-word"},children:[(0,_.jsx)(v.Z,{component:"span",sx:{fontWeight:"regular"},children:"".concat(t.name,", ").concat(t.stateCode)}),(0,_.jsx)(S.Z,{variant:"body2",color:"text.secondary",children:"".concat(t.zipCode,", ").concat(t.stateName)})]})]})}))}})}),(0,_.jsx)(v.Z,{component:"div",sx:{"& .MuiTextField-root":{m:1,width:"140px"}},children:(0,_.jsx)(h.Z,{select:!0,label:"Select Distance",value:J,onChange:function(e){Number.isInteger(Number(e.target.value))&&(G(Number(e.target.value)),null!==j&&void 0!==j&&j.location&&(n({lastLocation:j.location.join(","),distance:Number(e.target.value)}),$(!1)))},size:"small",fullWidth:!0,children:Array.from({length:20},(function(e,t){return 50+50*t})).map((function(e){return(0,_.jsx)(g.Z,{value:e,children:e},e)}))})}),(0,_.jsx)(p.Z,{title:"Filter list",children:!Y&&j||Y&&!j?(0,_.jsx)("span",{children:(0,_.jsx)(N.Z,{onClick:function(){b(null),w(""),G(200),n({}),$(!1)},children:(0,_.jsx)(O.Z,{})})}):(0,_.jsx)("span",{children:(0,_.jsx)(N.Z,{disabled:!j||!J,onClick:function(){null!==j&&void 0!==j&&j.location?n({lastLocation:j.location.join(","),distance:J}):n({}),$(!1)},children:(0,_.jsx)(I.Z,{})})})}),(0,_.jsx)(B.Z,{visible:ie})]})}function $(){var e=o.useState(void 0),t=(0,r.Z)(e,2),n=t[0],i=t[1],a=o.useState(void 0),s=(0,r.Z)(a,2),l=s[0],u=s[1],f=o.useState([]),x=(0,r.Z)(f,2),h=x[0],p=x[1],m=o.useState(0),g=(0,r.Z)(m,2),y=g[0],C=g[1],D=o.useState(15),S=(0,r.Z)(D,2),F=S[0],N=S[1],T=o.useState({}),I=(0,r.Z)(T,2),O=I[0],L=I[1],z=o.useRef(null),E=(0,c.TH)(),q=(0,c.s0)(),A=(0,M.Ds)(),U=(0,d.a)({queryKey:["trucks",y,F,l,n,O],queryFn:R.g7,keepPreviousData:!0,retry:!1,onError:function(e){A({severity:"error",message:e instanceof Error?e.message:JSON.stringify(e)})}}),W=U.isLoading,Q=U.isFetching,K=U.data,G=void 0===K?{items:[],total:0}:K,$=G.items,ee=G.total,te=$||[];o.useEffect((function(){z.current&&z.current.scrollTo({top:0,left:0,behavior:"smooth"})}),[te]),o.useEffect((function(){var e=[];h.forEach((function(t){te.find((function(e){return e.id===t}))&&e.push(t)})),p(e)}),[te]);return(0,_.jsxs)(v.Z,{sx:{width:"100%",height:"100%"},children:[(0,_.jsxs)(P.Z,{sx:{width:"100%",height:"100%",backgroundColor:"unset"},children:[(0,_.jsx)(Y,{selected:h,setQueryParams:function(e){L(e),C(0)}}),(0,_.jsx)(Z.Z,{ref:z,sx:{height:"calc(100% - 115px)"},children:(0,_.jsxs)(j.Z,{sx:{minWidth:750},"aria-labelledby":"tableTitle",size:"small",stickyHeader:!0,children:[(0,_.jsx)(X,{numSelected:h.length,order:n,orderBy:l,onSelectAllClick:function(e){if(e.target.checked){var t=te.map((function(e){return e.id}));p(t)}else p([])},onRequestSort:function(e,t){var a=l===t&&"asc"===n;l===t&&"desc"===n?(i(void 0),u(void 0)):(i(a?"desc":"asc"),u(t))},rowCount:te.length}),(0,_.jsx)(b.Z,{children:te.map((function(e,t){var n,i=(n="".concat(e.id),-1!==h.indexOf(n));return(0,_.jsxs)(w.Z,{hover:!0,onClick:function(t){q("./view/".concat(e.id),{relative:"path",state:{from:E},replace:!1})},role:"checkbox","aria-checked":i,tabIndex:-1,selected:i,sx:{cursor:"pointer"},children:[(0,_.jsx)(V,{padding:"checkbox",children:(0,_.jsx)(H,{truck:e,index:t})}),J.map((function(t){var n=t.getData(e);return(0,_.jsx)(V,{title:n.title,align:t.numeric?"right":"center",children:n.data},t.id)}))]},e.id)}))})]})}),(0,_.jsx)(k.Z,{rowsPerPageOptions:[5,10,15,20,25,35,50],component:"div",count:ee,rowsPerPage:F,page:y,onPageChange:function(e,t){C(t)},onRowsPerPageChange:function(e){N(parseInt(e.target.value,10)),C(0)}})]}),(0,_.jsx)(B.Z,{visible:W||Q})]})}}}]);
//# sourceMappingURL=666.4b749fd6.chunk.js.map